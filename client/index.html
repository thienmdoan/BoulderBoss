<!DOCTYPE html>
<html>
  <head>
    <meta git charset="utf-8">
    <meta name="apple-mobile-web-app-capable" content="yes"/>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fetch/2.0.2/fetch.min.js"></script>
    <script src="https://aframe.io/releases/0.5.0/aframe.min.js"></script>
    <script src="https://rawgit.com/protyze/aframe-alongpath-component/master/dist/aframe-alongpath-component.min.js"></script>
    <script src="https://cdn.rawgit.com/jujunjun110/aframe-crawling-cursor/master/dist/aframe-crawling-cursor.min.js"></script>
    <script src="https://rawgit.com/donmccurdy/aframe-extras/v2.1.1/dist/aframe-extras.loaders.min.js"></script>
    <script type="text/javascript">

  function updateCamera($camera, $dest) {
    const step = 0.04
    const dest = $dest.getAttribute('position')
    let pos = $camera.getAttribute('position')

      let xSteps = (dest.x - pos.x)
      let zSteps = (dest.z - pos.z)

    const interval = setInterval(function () {
      //if (pos.x >= dest.x && pos.z >= dest.z) {
      if (xSteps === 0 && zSteps === 0) {
        return clearInterval(interval)
      }
      else if(dest.x >= 0 && dest.z >= 0) {
    //    xSteps -= step
    //    zSteps -= step
        Object.assign(pos, {
          x: pos.x += step,
          z: pos.z += step
        })
        $camera.setAttribute('position', pos)
      }
      else if(dest.x <= 0 && dest.z >= 0) {
        Object.assign(pos, {
          x: pos.x -= step,
          z: pos.z += step
        })
        $camera.setAttribute('position', pos)
      }

      else if(dest.x >= 0 && dest.z <= 0) {
        Object.assign(pos, {
          x: pos.x += step,
          z: pos.z -= step
        })
        $camera.setAttribute('position', pos)
      }

      else if(dest.x <= 0 && dest.z <= 0) {
        Object.assign(pos, {
          x: pos.x -= step,
          z: pos.z -= step
        })
        $camera.setAttribute('position', pos)
      }
    }, 16)
  }

  AFRAME.registerComponent('cursor-listener', {
    init: function() {
      this.el.addEventListener('mousedown', event => {
        const $camera = document.getElementById('camera')
        const cam = $camera.getAttribute('position')
        const to = event.target.getAttribute('position')
        console.log('camera', cam)
        console.log('destination', to)
        updateCamera($camera, event.target)
      })
    }
  })
</script>
    <title>BoulderBoss</title>
  </head>
  <body>
    <a-scene id="scene">
      <a-entity position="0 1 4">
        <a-camera id="camera" rotation="11 0 0">
          <a-cursor color="white"></a-cursor>
        <!--   fuse="true" fusetimeout="2000"-->
        </a-camera>
      </a-entity>

      <a-assets>
        <video id="video" loop="true" src="PATAGONIA.mp4" webkit-playsinline/>
        <a-asset-item id="mountain" src="mountain.ply"></a-asset-item>
        <a-asset-item id="rain" src="rain.ply"></a-asset-item>
        <a-asset-item id="skyTexture" src="sky.jpg"></a-asset-item>
        <a-asset-item id="tree" src="/LowPolyTree/tree.dae"></a-asset-item>
        <a-asset-item id="cloud" src="Cloud_2.dae"></a-asset-item>
      </a-assets>

      <a-entity
        text="value: Patagonia; color: white"
        position="3 1.2 -4.5"
        align="center"
        scale="10 10 10">
      </a-entity>

      <a-entity
        text="value: Yosemite; color: white"
        position="-3.25 1 -5.25"
        rotation="0 40 0"
        align="center"
        scale="10 10 10">
      </a-entity>

      <a-entity
        text="value: Joshua Tree; color: white"
        position="7.25 1 -1.5"
        rotation="0 -40 0"
        align="center"
        scale="10 10 10"
        shader="sdf">
      </a-entity>

      <a-entity ply-model="src: #mountain" position="-4 0 42" rotation="-90 180 0"></a-entity>
      <a-light position="-19 24 7.5"></a-light>
      <a-light position="-5 .5 -26" intensity="0.5"></a-light>
      <a-sphere id="sphere" cursor-listener radius="1" position="12 6 15" color="red"></a-sphere>
      <a-dodecahedron cursor-listener position="10 2 4" scale= "1 1 1" color="gray" radius="5"></a-dodecahedron>

      <!--<a-sound src="bgsound.mp3" autoplay="true"></a-sound>-->

      <a-collada-model cursor-listener src="#tree" position="10 0 -5"></a-collada-model>
      <a-collada-model cursor-listener src="#tree" position="-15 0 10"></a-collada-model>
      <a-collada-model cursor-listener src="#tree" position="10 0 10"></a-collada-model>
      <a-collada-model cursor-listener src="#tree" position="-10 0 2"></a-collada-model>

    </a-scene>
    <script src="bundle.js"></script>
  </body>
</html>
